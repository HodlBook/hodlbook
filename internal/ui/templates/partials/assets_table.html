{{if .Empty}}
<div class="empty-state">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
    </svg>
    <h3>No Assets</h3>
    <p>Add your first asset to start tracking.</p>
    <button class="btn btn-primary" @click="$dispatch('open-add-asset')">Add Asset</button>
</div>
{{else}}
<input type="hidden" name="sort" value="{{.SortBy}}" class="sort-input">
<input type="hidden" name="dir" value="{{.SortDir}}" class="sort-input">
<div class="bulk-actions" x-show="selectedAssets.length > 0" x-cloak>
    <span class="bulk-count"><span x-text="selectedAssets.length"></span> selected</span>
    <button class="btn btn-sm btn-danger" @click="$dispatch('open-bulk-delete-assets')">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
        </svg>
        Delete Selected
    </button>
</div>
<table class="data-table">
    <thead>
        <tr>
            <th class="checkbox-col">
                <input type="checkbox" class="bulk-checkbox" @change="toggleAllAssets($event.target.checked)" :checked="allAssetsSelected">
            </th>
            <th class="date-col sortable{{if eq .SortBy "date"}} sorted {{.SortDir}}{{end}}"
                hx-get="/partials/assets/table?sort=date&dir={{if and (eq .SortBy "date") (eq .SortDir "desc")}}asc{{else}}desc{{end}}"
                hx-target="#assets-table-container"
                hx-include=".filters-row select, .filters-row input">
                Date <span class="sort-icon"></span>
            </th>
            <th class="sortable{{if eq .SortBy "type"}} sorted {{.SortDir}}{{end}}"
                hx-get="/partials/assets/table?sort=type&dir={{if and (eq .SortBy "type") (eq .SortDir "asc")}}desc{{else}}asc{{end}}"
                hx-target="#assets-table-container"
                hx-include=".filters-row select, .filters-row input">
                Type <span class="sort-icon"></span>
            </th>
            <th class="sortable{{if eq .SortBy "symbol"}} sorted {{.SortDir}}{{end}}"
                hx-get="/partials/assets/table?sort=symbol&dir={{if and (eq .SortBy "symbol") (eq .SortDir "asc")}}desc{{else}}asc{{end}}"
                hx-target="#assets-table-container"
                hx-include=".filters-row select, .filters-row input">
                Symbol <span class="sort-icon"></span>
            </th>
            <th class="text-right sortable{{if eq .SortBy "amount"}} sorted {{.SortDir}}{{end}}"
                hx-get="/partials/assets/table?sort=amount&dir={{if and (eq .SortBy "amount") (eq .SortDir "desc")}}asc{{else}}desc{{end}}"
                hx-target="#assets-table-container"
                hx-include=".filters-row select, .filters-row input">
                Amount <span class="sort-icon"></span>
            </th>
            <th class="text-right">Value (USD)</th>
            <th class="text-right">Current Value</th>
            <th class="text-right">Gain/Loss</th>
            <th>Provider</th>
            <th>Notes</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {{range .Assets}}
        <tr>
            <td class="checkbox-col">
                <input type="checkbox" class="row-checkbox" value="{{.ID}}" @change="toggleAsset({{.ID}}, $event.target.checked)" :checked="selectedAssets.includes({{.ID}})">
            </td>
            <td class="date-col">{{.Date}}</td>
            <td>
                <span class="badge badge-{{.TypeClass}}">{{.TransactionType}}</span>
            </td>
            <td>
                <span class="asset-symbol">{{.Symbol}}</span>
            </td>
            <td class="text-right font-medium">{{.Amount}}</td>
            <td class="text-right text-muted">{{if .HasUSDValue}}{{.USDValue}}{{else}}-{{end}}</td>
            <td class="text-right text-muted">{{if .HasCurrentValue}}{{.CurrentValue}}{{else}}-{{end}}</td>
            <td class="text-right">
                {{if .GainLossUSD}}
                <span class="gain-loss {{.GainLossClass}}">{{.GainLossUSD}} ({{.GainLossPercent}})</span>
                {{else}}-{{end}}
            </td>
            <td class="text-muted">{{.Provider}}</td>
            <td class="text-muted truncate">{{if .Notes}}{{.Notes}}{{else}}-{{end}}</td>
            <td class="text-right">
                <div class="action-buttons">
                    <button class="btn btn-sm btn-icon btn-secondary"
                        @click="$dispatch('open-edit-asset', {id: {{.ID}}, type: '{{.TransactionType}}', symbol: '{{.Symbol}}', name: '{{.Name}}', amount: {{.AmountRaw}}, timestamp: '{{.Timestamp}}', notes: '{{.Notes}}'})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                    </button>
                    <button class="btn btn-sm btn-icon btn-danger"
                        @click="$dispatch('open-delete-asset', {id: {{.ID}}})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                        </svg>
                    </button>
                </div>
            </td>
        </tr>
        {{end}}
    </tbody>
</table>

{{if gt .TotalPages 1}}
<div class="pagination">
    <span class="pagination-info">Page {{.Page}} of {{.TotalPages}}</span>
    <div class="pagination-controls">
        <button class="btn btn-sm" {{if not .HasPrev}}disabled{{end}}
            hx-get="/partials/assets/table?page={{if .HasPrev}}{{sub .Page 1}}{{else}}1{{end}}&sort={{.SortBy}}&dir={{.SortDir}}"
            hx-target="#assets-table-container"
            hx-include=".filters-row select, .filters-row input">
            Prev
        </button>
        <button class="btn btn-sm" {{if not .HasNext}}disabled{{end}}
            hx-get="/partials/assets/table?page={{if .HasNext}}{{add .Page 1}}{{else}}{{.TotalPages}}{{end}}&sort={{.SortBy}}&dir={{.SortDir}}"
            hx-target="#assets-table-container"
            hx-include=".filters-row select, .filters-row input">
            Next
        </button>
    </div>
</div>
{{end}}
{{end}}
